<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Billing-Site</title>

	<!-- Meta -->
	<meta name="description" content="Marketplace for Bootstrap Admin Dashboards" />
	<meta name="author" content="Bootstrap Gallery" />
	<link rel="canonical" href="https://www.bootstrap.gallery/">
	<meta property="og:url" content="https://www.bootstrap.gallery">
	<meta property="og:title" content="Admin Templates - Dashboard Templates | Bootstrap Gallery">
	<meta property="og:description" content="Marketplace for Bootstrap Admin Dashboards">
	<meta property="og:type" content="Website">
	<meta property="og:site_name" content="Bootstrap Gallery">
	<link rel="shortcut icon" href="~/images/favicon.ico" />
	<!-- Option 1: Include in HTML -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
	<link rel="stylesheet" href="~/css/main.css" />
	<!-- Scrollbar CSS -->
	@*<link rel="stylesheet" href="~/vendor/overlay-scroll/OverlayScrollbars.min.css" />*@
</head>

<body>
	<div class="message"></div>
	<!-- Page wrapper start -->
	<div class="page-wrapper">

		<!-- Main container start -->
		<div class="main-container">

			<!-- Sidebar wrapper start -->
			<nav id="sidebar" class="sidebar-wrapper">

				<!-- Sidebar profile starts -->
				<div class="sidebar-user-profile">
					@*<img src="~/images/NoorFood.png" class="sidebar-logo  img-side" alt="" />*@

				</div>
				<!-- Sidebar profile ends -->
				<!-- Sidebar menu starts -->
				<div class="sidebarMenuScroll">
					<ul class="sidebar-menu">
						<li class="active current-page">
							<a href="index.html">
								<i class="bi bi-shop-window"></i>
								<span class="menu-text">Sell </span>

							</a>
						</li>

						<li>
							@*<a href="report.html">*@
								<a href="@Url.Action("Report", "Product")">
								<i class="bi bi-card-checklist"></i>
								<span class="menu-text">Report</span>
							</a>
						</li>

						<li>
							<a href="profile.html">
								<i class="bi bi-people-fill"></i>
								<span class="menu-text">Profile</span>
							</a>
						</li>

						<li class="treeview">
							<a href="user.html">
								<i class="bi bi-person-circle"></i>
								<span class="menu-text">Admin</span>
							</a>
							<ul class="treeview-menu">
								<li>
									<a href="user.html">Users</a>
								</li>
								<li>
									<a href="product.html">Products</a>
								</li>

								<li>
									<a href="role.html">Roles</a>
								</li>
							</ul>
						</li>
						<li class="treeview d-none">
							<a href="login.html">
								<i class="bi bi-upc-scan"></i>
								<span class="menu-text">Login/Signup</span>
							</a>
							<ul class="treeview-menu">
								<li>
									<a href="login.html">Login</a>
								</li>
								<li>
									<a href="signup.html">Signup</a>
								</li>
								<li>
									<a href="forgetPassword.html">Forget Password</a>
								</li>

							</ul>
						</li>

					</ul>
				</div>
				<!-- Sidebar menu ends -->

			</nav>
			<!-- Sidebar wrapper end -->
			<!-- App container starts -->
			<div class="app-container position-relative">

				<!-- App header starts -->
				<div class="app-header d-flex align-items-center">

					<!-- Toggle buttons start -->
					<div class="d-flex">
						<button class="btn btn-outline-primary me-2 toggle-sidebar" id="toggle-sidebar">
							<i class="bi bi-chevron-left fs-5" id="toggle-icon-btn"></i>
						</button>
						<button class="btn btn-outline-primary me-2 pin-sidebar" id="pin-sidebar">
							<i class="bi bi-chevron-left fs-5" id="icon-btn"></i>
						</button>
					</div>
					<!-- Toggle buttons end -->
					<!-- App brand sm start -->
					<div class="app-brand-sm d-lg-none d-sm-block">
						<a href="index.html">
							<img src="~/images/NoorFood.png" class="logo" alt="logo Gallery">
						</a>
					</div>
					<!-- App brand sm end -->
					<!-- App header actions start -->
					<div class="header-actions">
						<div class="d-lg-block d-none me-2">
						</div>

						<div class="dropdown ms-3">
							<a id="userSettings"
							   class="dropdown-toggle d-flex py-2 align-items-center text-decoration-none" href="#!"
							   role="button" data-bs-toggle="dropdown" aria-expanded="false">
								<span class="d-none d-md-block me-2">Noor Food</span>
								@*<img src="~/images/profile.avif" class="rounded-circle img-3x"
									 alt="Bootstrap Gallery" />*@
							</a>
							<div class="dropdown-menu dropdown-menu-end shadow">
								<a class="dropdown-item d-flex align-items-center" href="profile.html">
									<i class="bi bi-person fs-4 me-2"></i>Profile
								</a>

								<a class="dropdown-item d-flex align-items-center" href="#" onclick="myFunction()">
									<i class="bi bi-escape fs-4 me-2"></i>Logout
								</a>
							</div>
						</div>
					</div>
					<!-- App header actions end -->

				</div>
				<!-- App header ends -->
				<!-- App hero header starts -->
				<div class="app-hero-header d-none ">
					<h2 class="">Selling Details</h2>
				</div>
				<!-- App Hero header ends -->
				<!-- App body starts -->
				<div class="app-body h-100 mt-0">
					<div class="row">
						<div class="col-xxl-12">
							<div class="card shadow mb-4">
								<div class="card-body">
									<div class="row">
										<div class="col-md-12    col-lg-7 mt-3 mt-lg-0">
											<div class="d-flex  align-items-center">
												<h4>Sell details</h4>
											</div>
										</div>
										<div class="col-md-12   col-lg-2 mt-3 mt-lg-0">
											<div class="d-flex justify-content-lg-end align-items-center">
												<h5 class="me-1">Date:</h5>
												<h4> <span class="badge text-bg-light">@DateTime.Now.ToString("dd-MM-yyyy")</span></h4>

											</div>
										</div>
										<div class="col-md-12    col-lg-3 mt-3 mt-lg-0">

											<div class="d-flex justify-content-lg-end align-items-center">
												<h5 class="me-1">Bill No:</h5>
												<h4 id="BillingId"><span class="badge text-bg-light">@ViewBag.BillNO</span></h4>

											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>


					<div class="row">
						<div class="col-xxl-12">
							<div class="card shadow mb-4">

								<div class="card-body">


									<hr class="mt-4">
									<div class="">
										
											<div id="dynamicRowsContainer">
												<!-- Dynamic rows will be added here -->
											</div>
											<div class="row form-group">
												<div class="col-sm-12   col-lg-4 mt-3 mt-lg-0">
													<div class="d-flex align-items-center">
														<label class=" form-label" style="width: 30%;" for="CustomerName">Customer Name</label>
														<input type="text" class="form-control " style="width: 70%;" id="CustomerName" name="CustomerName" placeholder="Customer Name">
													</div>
												</div>
												<div class="col-sm-12   col-lg-4 mt-3 mt-lg-0">
													 
													<div class="d-flex align-items-center">
														<label class=" form-label " style="width: 30%;" for="PhoneNo"> 
															Phone No.
														</label>
														<input class=" form-control" style="width: 70%;" id="PhoneNo" name="PhoneNo" placeholder="Enter phone No " />

													</div>
												</div>
												<div class="col-sm-12   col-lg-4 mt-3 mt-lg-0">
													<div class="d-flex  align-items-center">
														<label class=" form-label " style="width:30%;" for="PaymentType">PaymentType</label>
														<div style="width: 70%;">
															<select class="form-select" required name="PaymentType" id="PaymentType">
																<option value="0">-Select-</option>
																<option value="PhonePay">PhonePay</option>
																<option value="Gpay">Gpay</option>
																<option value="Paytm">Paytm</option>

															</select>
														</div>
													</div>
												</div>
											
											</div>
										<form method="post" id="Sale" novalidate class="sell-form">
											<div class="d-flex flex-column flex-lg-row" style="gap: 8px;">
												<div class="d-flex flex-column w-100 js-row">
													<div class="mb-2 sellFontWeight">Product Name</div>
													<div>
														<select class="form-select" required name="ProductId" id="ProductId">
															<option value="-1">- Select -</option>
															@foreach (var product in ViewBag.ProductDetails)
															{
																<option value="@product.ProductId">@product.ProductName</option>
															}
														</select>
													</div>


												</div>
												<div class="d-flex flex-column w-100 js-row">
													<div class="mb-2 sellFontWeight">Quantity(Per Gram)</div>
													<div>
														<input required type="text" placeholder="weight(per gram)" name="Quantity" id="Quantity" class="form-control">
													</div>


												</div>
												<div class="d-flex flex-column w-100 js-row">
													<div class="mb-2 sellFontWeight">Rate(Per KG)</div>
													<div>
														<input required type="text" placeholder="Rate" name="Price" id="Price" class="form-control">
													</div>


												</div>
												<div class="d-flex flex-column w-100 js-row">
													<div class="mb-2 sellFontWeight">Amount</div>
													<div>
														<input required type="text" placeholder="Amount" name="Amount" id="Amount" class="form-control">
													</div>


												</div>
												<div class="d-flex align-items-end  ">
													<div class="">
														<button type="submit" class="btn btn-primary sell-0  btn-save " data-rownum="sell-0" name="btn-add" id="sell-plus-btn-js">
															<i class="bi bi-plus-circle"></i>
														</button>
													</div>
												</div>
										   </div>

										</form>

									</div>

									<div class="row   mt-2  d-flex justify-content-center px-3  d-none table-data-js">
										<hr>
										<div class="table-responsive p-0 card-border border-2 p-2 mt-4">
											<table id="table-sell" class="table table-striped m-0">
												<thead class="table-primary">
													<tr>
														<th>Product Name</th>
														<th>Weight(Per Gram)</th>
														<th>Rate(Per KG)</th>
														<th colspan="2">Amount</th>
													</tr>
												</thead>
												<tbody>
												</tbody>
											</table>
										</div>

									</div>

									<!-- Row end -->

									<div class="card-footer">
										<div class="d-flex gap-2 justify-content-end">
											<button type="button" class="btn btn-primary" id="openModalButton">Print</button>
											<button type="button" class="btn btn-info btn-lg  ">
												Cancel
											</button>
											<button type="button" id="SaveSale" class="btn btn-primary btn-lg px-4 btn-save-table-data">
												Save
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>

					</div>
					<!-- App body ends -->




				</div>
				<!-- App footer start -->
				<div class="app-footer position-fixed bottom-0  w-100 " style="background-color: #e9edf2;">
					<h6>© Snmatrix 2023</h6>
				</div>
				<!-- App footer end -->
				<!-- App container ends -->

			</div>


		</div>
		<div class="modal fade" id="BillModal" tabindex="-1" aria-labelledby="BillModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header border-0">
						<!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
					</div>
					<div class="modal-body" id="section-to-print">
						<div class="container">
							<h6>
								NOOR FOOD AND AGRICULTURE</h5>
								<p>Masjid Road Kota,Raipur(C.G)</p>
								<p>Phone No.9630846788 Mobile No.:-</p>
								<hr style="border-top: 1px dashed black; opacity: 1;" />
								<h6 style="text-align: center;"><b>TOKEN/ BILL</b></h6>
								<hr style="border-top: 1px dashed black; opacity: 1;" />
								<div class="row">
									<div class="col-5"><b>Bill No.</b></div>
									<div class="col-7"><span>59,275</span></div>
									<div class="col-5"><b>Bill Date:</b></div>
									<div class="col-7"><span>18/11/2023</span></div>
									<div class="col-5"><b>Customer:</b></div>
									<div class="col-7"><span>Cash</span></div>
								</div>
								<hr style="border-top: 1px dashed black; opacity: 1;" />
								<div class="row">
									<div class="col-1"><b>Sr.</b></div>
									<div class="col-3"><b>Item Name</b></div>
									<div class="col-2"><b>Wt./Qt</b></div>
									<div class="col-2"><b>Nos</b></div>
									<div class="col-2"><b>Rate</b></div>
									<div class="col-2"><b>Amount</b></div>
								</div>
								<hr style="border-top: 1px dashed black; opacity: 1;" />
								<div class="row">
									<div class="col-1"><span>1</span></div>
									<div class="col-3"><span>EGG</span></div>
									<div class="col-2"><span>30.000</span></div>
									<div class="col-2"><span>0</span></div>
									<div class="col-2"><span>6</span></div>
									<div class="col-2"><span>175</span></div>
								</div>
								<hr style="border-top: 1px dashed black; opacity: 1;" />

								<div class="row">
									<div class="col-6"><b>Disc.Amt :</b></div>
									<div class="col-6" style="text-align: end;"><b>5.00</b></div>
									<div class="col-6"><b>Bill Amount :</b></div>
									<div class="col-6" style="text-align: end;"><b>175.00</b></div>
									<div class="col-6"><b>Outstanding :</b></div>
									<div class="col-6" style="text-align: end;"><b>0.00</b></div>
								</div>
								<hr style="border-top: 1px dashed black; opacity: 1;" />
								<p>Rs. One Hundred Seventy Five Only</p>
								<hr style="border-top: 1px dashed black; opacity: 1;" />
								<h6>Thankyou & Visit Again !</h6>
								<p>
									<h6>Designed by : www. mensioninrotech.com</h6>
								</p>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-info  " data-bs-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" onclick="window.print();  ">Print</button>
					</div>
				</div>
			</div>
		</div>
		

	

</body>

</html>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
	$(document).ready(function () {
		// Attach change event handler to the dropdown
		$("#ProductId").change(function () {
			$('#Amount, #Quantity').val('');
			var selectedProduct = $(this).val();
			// Call a function to update the rate based on the selected product
			updateRate(selectedProduct);
		});	
		
		$('#Quantity, #Price').on('input', function () {
			calculateAmount();
		});

		// Amount input field
		$('#Amount').on('input', function () {
			calculateQuantity();
		});

		$('#PhoneNo').on('input', function () {
			// Get the entered phone number value
			var enteredValue = $(this).val();

			// Check if the entered value doesn't already start with "+91"
			if (!enteredValue.startsWith("+91")) {
				// If not, append "+91" to the value
				$(this).val("+91" + enteredValue);
			}

			if ($(this).val().length > 12) {
				// If yes, truncate the value to 12 characters
				//$(this).val($(this).val().substring(0, 12));
				alert("Please check Phno ")
			}
		});

		$('#openModalButton').on('click', function () {
			// Simulate fetching data from the server (replace with your actual AJAX call)
			var billid=$("#BillingId").text();
			$.ajax({
				url: '/Home/GetBillData',
				method: "GET",
				data: { BillID: billid },
				dataType: "json",
				success: function (data) {
					debugger;
					console.log("AJAX request successful", data);
					updateModalContent(data);
				},
				error: function (xhr, status, error) {
					// Handle the error response
					console.error("AJAX request failed", status, error);
				}
			});

			// Update the modal content with the dynamic data
			//updateModalContent(dynamicData);

			// Open the modal
			$('#BillModal').modal('show');
		});

	});

	//function updateModalContent(data) {
	//	$('#BillModal').find('.modal-body').html(`
	//				<div class="container">
	//							<h6>
	//								NOOR FOOD AND AGRICULTURE</h5>
	//								<p>Masjid Road Kota,Raipur(C.G)</p>
	//								<p>Phone No.9630846788 Mobile No.:-</p>
	//								<hr style="border-top: 1px dashed black; opacity: 1;" />
	//								<h6 style="text-align: center;"><b>TOKEN/ BILL</b></h6>
	//								<hr style="border-top: 1px dashed black; opacity: 1;" />
	//								<div class="row">
	//									<div class="col-5"><b>Bill No.</b></div>
	//										<div class="col-7"><span>${data.billingId}</span></div>
	//									<div class="col-5"><b>Bill Date:</b></div>
	//										<div class="col-7"><span>${data.saleDate}</span></div>
	//									<div class="col-5"><b>Customer:</b></div>
	//											<div class="col-7"><span>${data.paymentType}</span></div>
	//								</div>
	//								<hr style="border-top: 1px dashed black; opacity: 1;" />
	//								<div class="row">
	//									<div class="col-1"><b>Sr.</b></div>
	//									<div class="col-3"><b>Item Name</b></div>
	//									<div class="col-2"><b>Wt./Qt</b></div>
	//									<div class="col-2"><b>Rate</b></div>
	//									<div class="col-2"><b>Amount</b></div>
	//								</div>
	//								<hr style="border-top: 1px dashed black; opacity: 1;" />
	//								<div class="row">
	//									<div class="col-1"><span>1</span></div>
	//											<div class="col-3"><span>${data.productName}</span></div>
	//										    <div class="col-2"><span>${data.quantity}</span></div>
	//											<div class="col-2"><span>${data.price}</span></div>
	//											<div class="col-2"><span>${data.amount}</span></div>
	//								</div>
	//								<hr style="border-top: 1px dashed black; opacity: 1;" />

	//								<div class="row">
	//									<div class="col-6"><b>Disc.Amt :</b></div>
	//									<div class="col-6" style="text-align: end;"><b>5.00</b></div>
	//									<div class="col-6"><b>Bill Amount :</b></div>
	//										<div class="col-6" style="text-align: end;"><b>${data.amount}</b></div>
	//									<div class="col-6"><b>Outstanding :</b></div>
	//									<div class="col-6" style="text-align: end;"><b>0.00</b></div>
	//								</div>
	//								<hr style="border-top: 1px dashed black; opacity: 1;" />
	//								<p>Rs. One Hundred Seventy Five Only</p>
	//								<hr style="border-top: 1px dashed black; opacity: 1;" />
	//								<h6>Thankyou & Visit Again !</h6>
	//								<p>
	//									<h6>Designed by :SnMatrix.com</h6>
	//								</p>
	//						</div>
				
	//		`);
	//}

	function updateModalContent(data) {
		// Start building the HTML content
		let modalBodyHtml = `
			<div class="container">
						<h6>
										NOOR FOOD AND AGRICULTURE</h5>
										<p>Masjid Road Kota,Raipur(C.G)</p>
										<p>Phone No.9630846788 Mobile No.:-</p>
										<hr style="border-top: 1px dashed black; opacity: 1;" />
										<h6 style="text-align: center;"><b>TOKEN/ BILL</b></h6>
										<hr style="border-top: 1px dashed black; opacity: 1;" />
										<div class="row">
											<div class="col-5"><b>Bill No.</b></div>
											<div class="col-7"><span>${data[0].billingId}</span></div>
											<div class="col-5"><b>Bill Date:</b></div>
											<div class="col-7"><span>${data[0].saleDate}</span></div>
											<div class="col-5"><b>Customer:</b></div>
											<div class="col-7"><span>${data[0].paymentType}</span></div>
										</div>
				<hr style="border-top: 1px dashed black; opacity: 1;" />
				<div class="row">
					<div class="col-1"><b>Sr.</b></div>
					<div class="col-3"><b>Item Name</b></div>
					<div class="col-2"><b>Wt./Qt</b></div>
					<div class="col-2"><b>Rate</b></div>
					<div class="col-2"><b>Amount</b></div>
				</div>
				<hr style="border-top: 1px dashed black; opacity: 1;" />
		`;

			let totalAmount = 0;
		// Loop through each record and append the corresponding HTML
		for (let i = 0; i < data.length; i++) {
			modalBodyHtml += `
				<div class="row">
					<div class="col-1"><span>${i + 1}</span></div>
					<div class="col-3"><span>${data[i].productName}</span></div>
					<div class="col-2"><span>${data[i].quantity}</span></div>
					<div class="col-2"><span>${data[i].price}</span></div>
					<div class="col-2"><span>${data[i].amount}</span></div>
				</div>
				<hr style="border-top: 1px dashed black; opacity: 1;" />
			`;
			totalAmount += data[i].amount;
		}
		const amountInWords = convertAmountToWords(totalAmount);
		// Continue building the HTML content
		modalBodyHtml += `
				<div class="row">
					<div class="col-6"><b>Disc.Amt :</b></div>
					<div class="col-6" style="text-align: end;"><b>0.00</b></div>
					<div class="col-6"><b>Bill Amount :</b></div>
						<div class="col-6" style="text-align: end;"><b>${totalAmount.toFixed(2)}</b></div>
					<div class="col-6"><b>Outstanding :</b></div>
					<div class="col-6" style="text-align: end;"><b>0.00</b></div>
				</div>
				<hr style="border-top: 1px dashed black; opacity: 1;" />
						<p>Rs. ${amountInWords} </p>
				<hr style="border-top: 1px dashed black; opacity: 1;" />
				<h6>Thankyou & Visit Again !</h6>
				<p>
					<h6>Designed by :SnMatrix.com</h6>
				</p>
			</div>
		`;

		// Set the HTML content to the modal body
		$('#BillModal').find('.modal-body').html(modalBodyHtml);
	}


	function updateRate(selectedProduct) {
		$.ajax({
			url: '/Home/GetProductRate',
			method: 'GET',
			data: { productName: selectedProduct },
			dataType: 'json',
			success: function (data) {
				// Update the rate field with the retrieved rate
				$("#Price").val(data.rate);
			},
			error: function (xhr, status, error) {
				// Handle the error response
				console.error("AJAX request failed", status, error);
			}
		});
	}

	function calculateAmount() {
		var weight = parseFloat($('#Quantity').val()) || 0; // Parse input to float, default to 0 if NaN
		var rate = parseFloat($('#Price').val()) || 0;

		// Calculate amount and update the Amount field
		var amount = weight * (rate / 1000); // Assuming rate is in per KG
		$('#Amount').val(amount.toFixed(2)); // Update the Amount field with 2 decimal places
	}

	function calculateQuantity() {
		var amount = parseFloat($('#Amount').val()) || 0;
		var rate = parseFloat($('#Price').val()) || 0;

		// Calculate quantity and update the Quantity field
		var quantity = (amount / rate) * 1000; 
		$('#Quantity').val(quantity.toFixed(2));
	}

	function convertAmountToWords(amount) {
		const units = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
		const teens = ["", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
		const tens = ["", "Ten", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
		const denominations = ["", "Thousand", "Million", "Billion", "Trillion"];

		function convertLessThanOneThousand(num) {
			let result = "";
			if (num >= 100) {
				result += units[Math.floor(num / 100)] + " Hundred ";
				num %= 100;
			}
			if (num >= 11 && num <= 19) {
				result += teens[num - 11] + " ";
			} else {
				result += tens[Math.floor(num / 10)] + " ";
				num %= 10;
				result += units[num] + " ";
			}
			return result;
		}

		function convertAmount(num) {
			let result = "";
			let i = 0;

			while (num > 0) {
				if (num % 1000 !== 0) {
					result = convertLessThanOneThousand(num % 1000) + denominations[i] + " " + result;
				}
				num = Math.floor(num / 1000);
				i++;
			}

			return result.trim();
		}

		const integerPart = Math.floor(amount);
		const fractionalPart = Math.round((amount % 1) * 100);

		let result = "";

		if (integerPart > 0) {
			result += convertAmount(integerPart) + " Rupees ";
		}

		if (fractionalPart > 0) {
			result += "and " + convertAmount(fractionalPart) + "/100 ";
		}

		result += "Only";

		return result.trim();
	}
	

</script>